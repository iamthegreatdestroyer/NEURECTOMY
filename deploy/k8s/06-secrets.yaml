---
# Prometheus Secret for sensitive credentials
apiVersion: v1
kind: Secret
metadata:
  name: prometheus-secrets
  namespace: monitoring
  labels:
    app: prometheus
type: Opaque
stringData:
  # Base64-encoded credentials (replace with your actual values)
  remote-write-username: "prometheus"
  remote-write-password: "changeme"
---
# Grafana Admin Secret
apiVersion: v1
kind: Secret
metadata:
  name: grafana-admin
  namespace: monitoring
  labels:
    app: grafana
type: Opaque
stringData:
  admin-user: "admin"
  admin-password: "changeme-grafana-password"
---
# AlertManager Secret
apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-config
  namespace: monitoring
  labels:
    app: alertmanager
type: Opaque
stringData:
  alertmanager.yml: |
    global:
      resolve_timeout: 5m
      slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
      pagerduty_url: 'https://events.pagerduty.com/v2/enqueue'

    route:
      receiver: 'default'
      group_by: ['alertname', 'cluster', 'service']
      group_wait: 10s
      group_interval: 10s
      repeat_interval: 12h
      routes:
        - match:
            severity: critical
          receiver: 'critical'
          group_wait: 0s
          repeat_interval: 5m
        - match:
            severity: warning
          receiver: 'warning'
          group_wait: 30s
        - match:
            severity: info
          receiver: 'info'
          group_wait: 5m

    receivers:
      - name: 'default'
        slack_configs:
          - channel: '#monitoring'
            title: 'Neurectomy Alert'
            text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
      
      - name: 'critical'
        pagerduty_configs:
          - service_key: 'YOUR-PAGERDUTY-KEY'
            description: '{{ .GroupLabels.alertname }} - {{ .Alerts.Firing | len }} firing'
        slack_configs:
          - channel: '#critical-alerts'
            title: 'CRITICAL: {{ .GroupLabels.alertname }}'
            text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
      
      - name: 'warning'
        slack_configs:
          - channel: '#warnings'
      
      - name: 'info'
        slack_configs:
          - channel: '#info'

    inhibit_rules:
      - source_match:
          severity: 'critical'
        target_match:
          severity: 'warning'
        equal: ['alertname', 'service']
      - source_match:
          severity: 'warning'
        target_match:
          severity: 'info'
        equal: ['alertname', 'service']
  slack-webhook: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
  pagerduty-key: "YOUR-PAGERDUTY-KEY"
---
# Grafana Datasources Secret
apiVersion: v1
kind: Secret
metadata:
  name: grafana-datasources
  namespace: monitoring
  labels:
    app: grafana
type: Opaque
stringData:
  prometheus-datasource.json: |
    {
      "apiVersion": 1,
      "datasources": [
        {
          "name": "Prometheus",
          "type": "prometheus",
          "access": "proxy",
          "url": "http://prometheus:9090",
          "isDefault": true,
          "editable": false
        },
        {
          "name": "Loki",
          "type": "loki",
          "access": "proxy",
          "url": "http://loki:3100",
          "isDefault": false,
          "editable": false
        }
      ]
    }

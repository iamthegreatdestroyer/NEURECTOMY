# ============================================================================
# NEURECTOMY - ArgoCD Secrets Template
# Credentials for repository access and SSO
# ============================================================================
# NOTE: In production, use External Secrets Operator to inject these values
apiVersion: v1
kind: Secret
metadata:
  name: argocd-secret
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-secret
    app.kubernetes.io/part-of: argocd
type: Opaque
stringData:
  # Admin password (bcrypt hash)
  # Generate with: htpasswd -nbBC 10 "" $PASSWORD | tr -d ':\n' | sed 's/$2y/$2a/'
  # Default: Change this immediately after deployment!
  admin.password: "$2a$10$placeholder.hash.change.me.immediately"

  # Admin password modification time
  admin.passwordMtime: "2025-01-01T00:00:00Z"

  # Server secret key for session management
  # Generate with: openssl rand -base64 32
  server.secretkey: "CHANGE_ME_TO_RANDOM_32_BYTE_KEY"

  # Optional: Webhook secret for GitHub
  # webhook.github.secret: "your-github-webhook-secret"

  # Optional: OIDC client secret
  # oidc.okta.clientSecret: "your-oidc-client-secret"

---
# Repository credentials secret (for private repos)
apiVersion: v1
kind: Secret
metadata:
  name: neurectomy-repo-creds
  namespace: argocd
  labels:
    argocd.argoproj.io/secret-type: repository
type: Opaque
stringData:
  type: git
  url: https://github.com/iamthegreatdestroyer/NEURECTOMY
  # For GitHub App authentication (recommended):
  # githubAppID: "your-app-id"
  # githubAppInstallationID: "your-installation-id"
  # githubAppPrivateKey: |
  #   -----BEGIN RSA PRIVATE KEY-----
  #   ...
  #   -----END RSA PRIVATE KEY-----

  # For PAT authentication:
  # username: your-username
  # password: your-github-pat

---
# External Secrets - AWS Secrets Manager Integration
# (Use this in production instead of plain secrets)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: argocd-external-secret
  namespace: argocd
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: argocd-secret
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        admin.password: "{{ .admin_password }}"
        admin.passwordMtime: "{{ .admin_password_mtime }}"
        server.secretkey: "{{ .server_secret_key }}"
  data:
    - secretKey: admin_password
      remoteRef:
        key: neurectomy/argocd
        property: admin_password
    - secretKey: admin_password_mtime
      remoteRef:
        key: neurectomy/argocd
        property: admin_password_mtime
    - secretKey: server_secret_key
      remoteRef:
        key: neurectomy/argocd
        property: server_secret_key
